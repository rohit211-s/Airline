version: "3.9"
services:
  react:
    container_name: airline_analysis_frontend
    build:
      context: ./frontend
    volumes:
      - ./frontend:/app/frontend
      - /app/frontend/node_modules
    ports:
      - ${AIRLINE_ANALYSIS_FRONTEND_PORT}:3000

  node:
    container_name: airline_analysis_backend
    build:
      context: ./backend
    volumes:
      - ./backend:/app/backend
      - /app/backend/node_modules
    ports:
      - ${AIRLINE_ANALYSIS_BACKEND_PORT}:4201
    depends_on:
      - react
      - db
    env_file: .env
    environment:
      AIRLINE_ANALYSIS_DATABASE_CONNECTION_STRING: "${AIRLINE_ANALYSIS_DATABASE_HOSTNAME}:${AIRLINE_ANALYSIS_DATABASE_PORT}/${AIRLINE_ANALYSIS_DATABASE_SERVICE_NAME}"
    
  db:
    container_name: airline_analysis_db
    image: gvenzl/oracle-free:23.4-slim
    ports:
      - "1521:1521"  
    environment:
      ORACLE_PASSWORD: "${AIRLINE_ANALYSIS_DATABASE_PASSWORD}"
      ORACLE_DATABASE: "${AIRLINE_ANALYSIS_DATABASE_NAME}"
      APP_USER: "${AIRLINE_ANALYSIS_DATABASE_USER}"
      APP_USER_PASSWORD: "${AIRLINE_ANALYSIS_DATABASE_PASSWORD}"
    volumes:
      # - ./database:/container-entrypoint-initdb.d
      - ./database:/opt/oracle/oradata
      - /opt/oracle/oradata

  nginx:
    depends_on:
      - react
      - db
      - node
    restart: always
    build:
      context: ./nginx
      dockerfile: Dockerfile
    ports:
      - ${AIRLINE_ANALYSIS_NGINX_PORT}:80
